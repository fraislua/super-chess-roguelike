# 強者の威圧 (Tyrant's March) - システム仕様

## 1. 概要
「強者の威圧 (Tyrant's March)」は、移動経路上にいる敵ユニットを物理的に「粉砕」し、強制的に盤面から排除しながら移動できるTier 4（レジェンダリー）スキルです。

## 2. 適用条件
- **対象となる移動**: スライディング移動（ルーク、ビショップ、クイーンの縦・横・斜め移動）。
- **対象外**: ナイトのジャンプ移動、キングの1歩移動（基本的な動きとしてはスライディング判定を用いないため）。ただし、スキル等でスライディング移動を得た場合は適用される可能性があります（現状の実装では `getSlidingMoves` を使用するものに限る）。
- **発動条件**: 移動経路上に敵駒が存在し、かつ最終的に**空いているマス**に着地できること。
    - 敵の駒の上で止まる（通常のキャプチャ）ことはできません。敵を「突き抜ける」必要があります。

## 3. 実装ロジック詳細

### A. 移動生成 (`Piece.js`)
`getSlidingMoves` メソッド内で処理されます。

1. **経路探索**: 進行方向のマスをスキャンします。
2. **敵との接触**: 敵駒に遭遇した場合、通常であれば移動はそこで止まります（攻撃対象）。しかし、このスキルを持っている場合、その敵を「粉砕リスト(`crushed`)」に追加し、さらに奥のマスへ探索を続けます。
3. **着地判定**:
    - **空きマス**: 敵を通過した後に空きマスに到達した場合、そのマスへの移動は有効となり、移動タイプ `tyrant_move` として登録されます。この移動データには、通過したすべての敵のリストが含まれます。
    - **敵マス**: 連続して敵がいる場合もリストに追加して進みます。
    - **味方/壁**: 味方や盤外に到達した場合は、そこで探索終了です（貫通不可）。

### B. ルール検証 (`Rules.js`)
移動が「王手（チェック）」を誘発しないかの判定において、特殊なシミュレーションを行います。

1. **シミュレーション**: 盤面を複製(`clone`)し、仮に移動を行います。
2. **粉砕の反映**: `tyrant_move` の場合、移動先に駒を置く**前**（または同時）に、`crushed` リストに含まれる敵駒を複製盤面から**削除** (`null`化) します。
3. **チェック判定**: 敵が消滅した状態の盤面で、自軍キングが攻撃されていないかを確認します。
    - これにより、「敵が道を塞いでいるためキングが守れない」あるいは「敵がキングを狙っているが、それを轢き殺して移動すれば安全になる」といった状況を正しく判定できます。

### C. 実行処理 (`Game.js`)
プレイヤーが移動を確定した際の処理です。

1. **粉砕実行**: 移動データに含まれる `crushed` リストの全敵駒に対し、盤面情報(`board.setPiece`)を `null` に更新します（消滅）。
2. **ログ出力**: 「[〇〇を粉砕]」というログを表示します。
3. **移動**: 自身の駒を通常の移動処理と同様に目的地へ配置します。
4. **制約**: 粉砕された敵は「撃破」扱いとなりますが、通常の戦闘（攻撃側・防御側のステータス計算など）はスキップされ、一方的に排除されます。

## 4. 主な制約・仕様
- **通過のみ**: 敵のいるマスで止まることはできず、必ず突き抜けて空きマスに着地する必要があります。
- **ナイト除外**: ジャンプ移動には適用されません（仕様として定義済み）。
- **経験値**: 現状の実装では、粉砕した敵からの経験値獲得やドロップ処理は `completeMoveProcessing` のキャプチャ処理とは別枠（あるいは未実装）の可能性があります。※要確認: 現状は `movePiece` 前に消しているので、通常の `capturedPiece` 処理には乗らない仕様です。

以上
